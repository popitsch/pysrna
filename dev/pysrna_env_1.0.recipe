Bootstrap: docker
From: python:3.7-buster

%help
	pysrna  environment including Python3.7 and R 

%labels
	Maintainer niko.popitsch@univie.ac.at
	Version 1.0

%environment
	# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	# This sets global environment variables for anything run within the container
	export PYTHONPATH='/usr/local/lib/python3.7/site-packages/'

%post

	# install tzdata with default settings (to avoid installation dialog!)
        DEBIAN_FRONTEND=noninteractive apt-get install -y tzdata
        # install additional packages and java
        apt-get update && apt-get install -y --no-install-recommends \
		dialog build-essential r-base r-cran-randomforest ca-certificates curl git wget zlib1g-dev bzip2 libbz2-dev liblzma-dev libcurl4 libcurl4-openssl-dev default-jre gfortran libopenblas-base libopenblas-dev

        # install R packages
        R --slave -e 'install.packages(c("jsonlite", "crayon", "data.table", "dplyr", "tidyr", "ggplot2", "cowplot","grid","gridExtra","tibble"), repos="https://cloud.r-project.org/")'
 
	# install required python packages
        pip3 install wheel 
        pip3 install --upgrade cython tqdm pandas numpy pysam biopython intervaltree scipy pybedtools

	# install bedtools
        wget https://github.com/arq5x/bedtools2/releases/download/v2.29.1/bedtools-2.29.1.tar.gz
	tar -zxvf bedtools-2.29.1.tar.gz
	cd bedtools2
	make
	cd ..
        ln -s /bedtools2/bin/bedtools /usr/bin/bedtools

        # install htslib (for bgzip and tabix)
        wget https://github.com/samtools/htslib/releases/download/1.9/htslib-1.9.tar.bz2
        tar -xjvf htslib-1.9.tar.bz2
        cd htslib-1.9
        make
        make prefix=/usr/local/bin install
        ln -s /usr/local/bin/bin/bgzip /usr/bin/bgzip
        ln -s /usr/local/bin/bin/tabix /usr/bin/tabix
        cd ..

	# install samtools
	wget https://github.com/samtools/samtools/releases/download/1.9/samtools-1.9.tar.bz2
        tar -xjvf samtools-1.9.tar.bz2
        cd samtools-1.9
        make
        make prefix=/usr/local/bin install
	ln -s /usr/local/bin/bin/samtools /usr/bin/samtools
	cd ..

	# install fastp
	mkdir fastp && cd fastp
	wget http://opengene.org/fastp/fastp
	chmod a+x ./fastp	
	ln -s /fastp/fastp /usr/bin/fastp
	cd ..

	# install fastqc
	wget https://www.bioinformatics.babraham.ac.uk/projects/fastqc/fastqc_v0.12.1.zip
	unzip fastqc_v0.12.1.zip
	chmod a+x /FastQC/fastqc
	ln -s /FastQC/fastqc /usr/bin/fastqc

	# install genmap
	mkdir genmap && cd genmap
	wget https://github.com/cpockrandt/genmap/releases/download/genmap-v1.3.0/genmap-1.3.0-Linux-x86_64.zip
	unzip genmap-1.3.0-Linux-x86_64.zip
	chmod a+x ./genmap
	ln -s /genmap/genmap /usr/bin/genmap
	cd ..

	# install Tailor
	mkdir tailor && cd tailor
	wget -O tailor_v1.1 https://github.com/jhhung/Tailor/releases/download/v1.1/tailor_v1.1_linux_static
	chmod a+x ./tailor_v1.1
	ln -s /tailor/tailor_v1.1 /usr/bin/tailor_v1.1
	cd ..
